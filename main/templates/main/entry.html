{% extends 'main/base.html' %}
{% load leaflet_tags %}
{% load static %}
{% load widget_tweaks %}

{% block head %}
{{ form.media.css }}
{% leaflet_js %}
{% leaflet_css %}

<!-- https://docs.mapbox.com/mapbox-gl-js/example/mapbox-gl-draw/ -->
<!--  Mapbox GL JS-->
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<!--  GeoCoder -->
<meta name='robots' content='noindex, nofollow'>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.1.0/mapbox-gl-geocoder.min.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.1.0/mapbox-gl-geocoder.css' type='text/css' />
<!--  Polygon Draw-->
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
<!--  Turf JS for calculating the area. -->
<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>

<!--  Mapbox Draw -->
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.css' type='text/css' />
<link rel="stylesheet" href="{% static 'main/css/style.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <script>
        sessionStorage.setItem("allChecks", "pass");
  console.log("passed");
</script>
    <div class="row row-content">
        <div class="col">
            <h2 class="text-primary">
              {% if LANGUAGE_CODE == 'en' %}
              Draw your community!
              {% elif LANGUAGE_CODE == 'es' %}
              <!-- Google translate  -->
              ¡Dibuja tu comunidad!
              {% endif %}
            </h2>
            <p class="p-about">
                {% if LANGUAGE_CODE == 'en' %}
                Representable helps fight against gerrymandering by empowering communities
                to represent themselves more easily. Fill out the form below to
                add your community
                {% elif LANGUAGE_CODE == 'es' %}
                <!-- Google translate  -->
                Representable ayuda a luchar contra la gerrymandering empoderando a las comunidades
                representarse más fácilmente. Complete el siguiente formulario para
                agrega tu comunidad
                {% endif %}
            </p>
        </div>
        <div class="col-sm-12">
            <!-- START FORM BODY -->
            <div class="row mt-3">
                <!-- Entry Form -->
                <form id="entryForm" method="post">
                    <!-- First Row: Includes Map. -->
                    <div class="row row-equal-cols">
                        <div class="col-lg-8 mt-3">
                            <div class="card">
                                <div class="card-header text-header-card">
                                    <strong>
                                      {% if LANGUAGE_CODE == 'en' %}
                                      1. Please enter the zipcode of your community as a starting point.
                                      {% elif LANGUAGE_CODE == 'es' %}
                                      <!-- Google translate  -->
                                      Ingrese el código postal de su comunidad como punto de partida.
                                      {% endif %}
                                    </strong>
                                </div>
                                <div class ="px-3">
                                    <p>
                                        <div id="geocoder" class="geocoder"></div>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!-- Map -->
                        <div class="col-lg-8 mt-3">
                            <div class="blurtop">
                            <div class="card">
                                <div class="card-header text-header-card">
                                    <strong>
                                    {% if LANGUAGE_CODE == 'en' %}
                                    2. What does your community look like?
                                    {% elif LANGUAGE_CODE == 'es' %}
                                    <!-- Google translate  -->
                                    ¿Cómo se ve tu comunidad?
                                    {% endif %}
                                    </strong>
                                </div>
                                <div id='map-card' class="card-body">
                                    <!-- {# Include form.entry_polygon error. } -->
                                    <div id="map-error-alerts">
                                        {% if form.user_polygon.errors %}
                                        <script>
                                            sessionStorage.setItem("allChecks", "fail");
                                        </script>
                                        <div id="polygon_missing" class="alert alert-warning alert-dismissible fade show" role="alert">
                                            {% if LANGUAGE_CODE == 'en' %}
                                            You need to draw a polygon to submit the form.
                                            {% elif LANGUAGE_CODE == 'es' %}
                                            <!-- Google translate  -->
                                            Debe dibujar un polígono para enviar el formulario.
                                            {% endif %}
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div id='menu'>
                                    </div>
                                    <div id='map' class='draw_polygon_map'>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                        <div class="col-lg-4 mt-3">
                            <div class="card mb-3">
                                <div class="card-header text-info-custom">
                                    <b>
                                      {% if LANGUAGE_CODE == 'en' %}
                                      How do I draw my community?
                                      {% elif LANGUAGE_CODE == 'es' %}
                                      <!-- Google translate  -->
                                      ¿Cómo dibujo a mi comunidad?
                                      {% endif %}
                                    </b>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">
                                        1. Type in your zip code when prompted
                                        <hr>
                                        </hr>
                                        <div class="blurtop">
                                        2. Press on <b> Draw Polygon </b> and draw a shape that includes everything you consider to be part of your community.
                                        <hr>
                                        </hr>
                                        This shape can include schools, watersheds, parks, administrative
                                        buildings, commercial centers, etc.
                                        <hr>
                                        </hr>
                                        3. Once you're done drawing, <b> click on your polygon </b> to edit it.
                                        <hr>
                                        </hr>
                                        4. Don't worry about making a mistake! You can always start again. Just press on <b> Delete Polygon </b> and again on <b> Draw Polygon </b>.
                                    </div>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <hr> -->
                    <div class="row row-equal-cols">
                        <div class="col-lg-8  mt-3">
                            <div class="blurtop">
                            <div class="card">
                                <div class="card-header text-header-card">
                                    <strong>3. What brings your community together?</strong>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">
                                        What name can we use to identify your community? <small class="text-danger">(Required)</small>
                                        <!-- TODO we should find a better example -->
                                        <br>
                                        <small>For example: Princeton area student community</small>
                                    </p>
                                    {{ form.entry_name|append_attr:"class:form-control" }}
                                    <hr>
                                    <p class="card-text">
                                        Why are you identifying this area as a community? <small class="text-danger">(Required)</small>
                                        <!-- TODO we should find a better example -->
                                        <br>
                                        <small>For example: All of the on-campus Princeton University student body lives and studies in this geographic area.</small>
                                    </p>
                                    {{ form.entry_reason|append_attr:"class:form-control" }}
                                    <hr>
                                    {% csrf_token %}
                                    <!-- {# Include the non-field error fields #} -->
                                    {% if form.non_field_errors %}
                                    <div class="non-field-errors">
                                        {% for err in form.non_field_errors %}
                                        <p class="form-error">{{ err }}</p>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    <div id="main_community_form" class="form-group">
                                        <!-- {# Include the hidden fields #} -->
                                        {% for hidden in form.hidden_fields %}
                                        {{ hidden }}
                                        {% endfor %}
                                        <!-- {# Tags Field} -->
                                        <div class="field-wrap mt-3">
                                            {{ form.tags.label_tag }}
                                            <div class="form-error">
                                                {{ form.tags.errors }}
                                            </div>
                                            {{ form.tags|append_attr:"class:form-control" }}
                                            {% if form.tags.help_text %}
                                            <p class="help">{{ form.tags.help_text|safe }}</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                </form>
                <div class='row mt-4 w-100'>
                    <div class='col-12 text-center'>
                        <div class="alert alert-primary text-center" role="alert">
                            {% if LANGUAGE_CODE == 'en' %}
                            After you submit, your map will be reviewed by the Representable team. Once it's approved it will be shown on the <a href="/map" class="alert-link">Map</a> page.
                            {% elif LANGUAGE_CODE == 'es' %}
                            <!-- Google translate  -->
                            Después de enviar, su mapa será revisado por el equipo Representable. Una vez aprobado, se mostrará en la página <a href="/map" class="alert-link"> Mapa </a>
                            {% endif %}
                        </div>
                        <div style="display: inline-block;">
                            <button id="save" form="entryForm" type="submit" class="btn btn-primary" value="Submit">Submit Entry</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    {% endblock %}
    {% block script %}
    {{ form.media.js }}
    <script type="text/javascript">
        mapboxgl.accessToken = "{{ mapbox_key }}";
    </script>
    <script type="text/javascript" src="{% static 'main/js/wicket.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/geo.js' %}"></script>
    <!-- Turf to get the bounding box. -->
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    {% endblock %}
