<!DOCTYPE html>
{% load static %}
<html>
<head>
<meta charset='utf-8' />
<title>Learn More</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
<style>
body { margin:0; padding:0; }
#map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>

<style>
#map {
position: fixed;
width:50%;
}
#features {
width: 50%;
margin-left: 50%;
font-family: sans-serif;
overflow-y: scroll;
background-color: #fafafa;
}
section {
padding:  25px 50px;
line-height: 25px;
border-bottom: 1px solid #ddd;
opacity: 0.25;
font-size: 13px;
}
section.active {
opacity: 1;
}
section:last-child {
border-bottom: none;
margin-bottom: 500px;
}
</style>

<div id='map'></div>
<div id='features'>
<section id='View1' class='active'>
<h2>1. Browse the map.</h2>
<p> Explore the map by entering in a zipcode in the search box and navigate to your
  local community using interactive features <br>
  NY view 1 </p>
</section>
<section id='View2'>
<h2>2. Navigate your community</h2>
<p> Using a variety of map views and add on geographic and census features, get
  a better understanding for your geospatial COI <br>
  Washington DC 2 -- areas of peak interest </p>
</section>
<section id='View3'>
<h2>3. Draw ur COI</h2>
<p>Using the Polygon draw tool, click ___, and begin to draw your COI! click on a point on the map to create
a vertex and click twice on your final vertex to finalize your polygon. To start over press the trash can
on the right hand of the screen. To edit the polygon once made simply click on a vertex and drag accorginly or
even drag the entire shape over. <br>
browse to COI view :: filled in district in New Jersey </p>
</section>
<section id='View4'>
<h2>4. Demographic Data </h2>
<p>Help us understand the importance of this community for you, and identify aggregate trends in your commynity
by submitting your demographic information and policy needs on the right
hand side of the screen <br>
insert image of form and browse to view of the form fields filled out </p>
</section>
<section id='View5'>
<h2>5. Submit data !</h2>
<p>Submit the data to be entered into a critical databse of citizens in your area
who want to have their voices heard during redistricting <br>
go to animation of submitting data / redistricting? </p>
</section>
<section id='View6'>
<h2>6. Explore!</h2>
<p> Return to the main menu to explore submissions by others near you, interesting trends,
and the latest in Representable news. <br>
pan to map view ,, visualizations </p>
</section>
</div>
<script>
mapboxgl.accessToken = "{{ mapbox_key }}";

var map = new mapboxgl.Map({
container: 'map',
style: 'mapbox://styles/mapbox/streets-v11',
center: [-122.463, 37.7648],
zoom: 8.5,
bearing: 0,
pitch: 10
});

// DATA ONTO MAP FOR LATER ANIMATION NEEDS ____________________
map.on('load', function () {

// 1. COI - - - - - - - - -
map.addLayer({
'id': 'COI',
'type': 'fill',
'source': {
'type': 'geojson',
'data': {
'type': 'Feature',
'geometry': {
'type': 'Polygon',
'coordinates': [[[-74.6480685607903, 40.36014689653257],
[-74.66763795775572, 40.355699411474774],
[-74.65682329101108, 40.35177491632288],
[-74.6480685607903, 40.353868008822985],
[-74.6480685607903, 40.36014689653257]]]
    }
  }
},
'layout': {},
'paint': {
'fill-color': '#088',
'fill-opacity': 0.8
  }
 });


// 2. demographic data - - - - -
//var DemoImage = new mapboxgl.ImageSource({
  //      url: "{% static 'img/gerry.png' %}",
    //    coordinates: [
      //      [-80.425, 46.437],
        //    [-71.516, 46.437],
          //  [-71.516, 37.936],
            //[-80.425, 37.936]
//        ]
// });

//map.addSource('Demo_Image',DemoImage);
//map.addLayer({
//    "id": "Demo_Image",
//    "source": "Demo_Image",
//    "type": "raster",
//   });

map.loadImage("{% static 'img/gerry.png' %}",function(error, image) {
  if (error) throw error;
map.addImage('demographics', image);
map.addLayer({
"id": "DEMO",
"type": "symbol",
"source": {
  "type": "geojson",
  "data": {
      "type": "FeatureCollection",
      "features": [{
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "coordinates": [-109, 56]
          }
        }]
      }
},
  "layout": {
    "icon-image": "demographics",
    "icon-size": 0.2
    }
  });
});

});

// ____________ ADD ANIMATION :: LAYERS _______________
var chapters = {
  'View1': {
  bearing: 27,
  center: [-77.0366, 38.895],
  zoom: 11.5,
   pitch: 20
},
  'View2': {
  center: [-77.07303,38.90767],
  bearing: 150,
  zoom: 15,
  pitch: 0
},
  'View3': {
  bearing: 90,
  center: [-74.657875,40.34765],
  zoom: 13,
  pitch: 40
},
  'View4': {
  bearing: 90,
  center: [-80.54, 39.18],
  zoom: 12.3
},
  'View5': {
  bearing: 45,
  center: [-0.18335806, 51.49439521],
  zoom: 15.3,
  pitch: 20,
  speed: 0.5
},
  'View6': {
  bearing: 180,
  center: [-0.19684993, 51.5033856],
  zoom: 12.3
},
};

// On every scroll event, check which element is on screen
window.onscroll = function() {
var chapterNames = Object.keys(chapters);
for (var i = 0; i < chapterNames.length; i++) {
var chapterName = chapterNames[i];
if (isElementOnScreen(chapterName)) {
setActiveChapter(chapterName);
break;
}
}
};

var activeChapterName = 'View1';
function setActiveChapter(chapterName) {
if (chapterName === activeChapterName) return;

map.flyTo(chapters[chapterName]);

document.getElementById(chapterName).setAttribute('class', 'active');
document.getElementById(activeChapterName).setAttribute('class', '');

activeChapterName = chapterName;
}

function isElementOnScreen(id) {
var element = document.getElementById(id);
var bounds = element.getBoundingClientRect();
return bounds.top < window.innerHeight && bounds.bottom > 0;
}

</script>

</body>
</html>
